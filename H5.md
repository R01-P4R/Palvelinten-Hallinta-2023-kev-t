# x)

 
 
 
 
## 	 Control Windows with Salt, Tero Karvinen (18.4.2018)  (https://terokarvinen.com/2018/control-windows-with-salt/)

Tero Karvinen kertoo artikkelissaan 'Control Windows with Salt', kuinka Saltin avulla voidaan kontrolloida eri prosesseja Windowsilla.

   * Uusimmat Salt-versiot toimivat paremmin Windowsilla, kuin aikaisemmin.
   * Luodakseen Windowsista Salt-orjan on asennettava samat Salt-paketit kyseiselle koneelle, kuin herra-koneella.
   * Windows-koneet on hyväksyttävä uusiksi orjakoneiksi ja ne yleensä vastaavat hitaammin herra-koneen kutsuihin.
   * Saltin Windowsin ohjelmistokirjastot on hyväksyttävä, jotta ohjelmia on helpompi asentaa.
   * PowerShell on Windowsin versio Bash:sta.
   * Saltia voi myös suorittaa Windowsilta käsin paikallisesti.
   * Chocolateyn avulla voi asentaa monia eri paketteja.
   


## Harjoitus 5, Linux-master meets Windows-slave, pseppanen (26.11.2018) (https://pseppanen296518693.wordpress.com/2018/11/26/harjoitus-5-linux-master-meets-windows-slave/)

Pseppasen raportti 'Harjoitus 5, Linux-master meets Windows-slave' käsittelee Saltin käyttöä siten, että Windows on orja-roolissa.

   * Herra- ja orja-koneella on oltava samat Salt-versiot ja paketit käytössä.
   * PowerShellin avulla voi tehdä säädöksiä paikallisesti, ilman herra-orja-arkkitehtuuria
   * Orjaa luodessa on tiedettävä herra-koneen IP-osoite.
   
  
   
   
   
   
 # H5
 
Harjoituksen tarkoituksena on asentaa Windowsille Salt-minionohjelmisto ja 
 

 
 
### Laitteisto
 
* Käyttöjärjestelmä	Microsoft Windows 10 Enterprise LTSC 64 bit
* Prosessori i5-6600
* RAM 16 GB





## Saltin asennus Windowsille (16:14)
Asennetaan Salt v3006.0 Windowsille (https://repo.saltproject.io/salt/py3/windows/latest/Salt-Minion-3006.0-Py3-AMD64-Setup.exe)

Aloitin tarkistamalla Saltin version 

Aloitin lataamalla asennustiedoston osoitteesta (https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/windows.html#windows-downloads)

![image](https://user-images.githubusercontent.com/106889187/235456808-62dea31a-582c-498e-b09c-29c2b514d7fb.png)

Seuraavaksi avasin asennustiedoston.

![image](https://user-images.githubusercontent.com/106889187/235456933-2a793197-7c4c-4fb7-9c32-3a0c20ee1632.png)

Määritin asetukset seuraavanlaisesti ja painoin 'Install'.

![image](https://user-images.githubusercontent.com/106889187/235460729-0595e814-d94b-46c3-9190-cc77ea0cd972.png)

Saltin asennettua avasin PowerShellin adminina ja testasin asennuksen onnistumista komennolla:

    > salt-call --local test.ping
    
   ![image](https://user-images.githubusercontent.com/106889187/235461234-b4a40f4f-80ff-45ac-826d-1950fc63f807.png)
   
   Hitaasti, mutta varmasti vastattiin kutsuun.
   
   
 ## Testataan Saltia paikallisesti (16:53)
 
 Suoritetaan muutamia Salt-komentoja paikallisesti PowerSHellissä.
 
 Aloitin kokeilemalla komentoa:
 
     > salt-call --local cmd.run 'whoami'
     
 Suorittaakseni paikallisesti komennon PowerShellissä 'whoami', joka kertoo nykyisen käyttäjän.
 
![image](https://user-images.githubusercontent.com/106889187/235461973-e487d82d-a2ec-4182-b188-59d79073a196.png)

Komennon suoritus onnistui.

Seuraavaksi kokeilin suorittaa komennon:

    > salt-call --local --version
    
Selvittääkseni nykyisen Saltin version.

![image](https://user-images.githubusercontent.com/106889187/235463019-ef1af166-6f56-45db-8cbc-8bc56cdc8f6e.png)

Komento onnistui,  3006.0 on Saltin versionumero ja 'Sulfur' on kyseisen Saltin version nimi.
  
## Hei Maailma Windowsille Saltilla

Luodaan uusi tekstitiedosto 'helloworld.txt' koneelle Saltin avulla.

Aloitin luomalla uuden kansion komennolla:

    > mkdir scripttest
    
Ja sen sisälle tiedoston komennolla:

    > notepad hellowindows.ps1

Jonka sisälle kirjoitin 
 
      echo 'hello world!'
      
 ![image](https://user-images.githubusercontent.com/106889187/235468916-9d173e66-47cb-4397-be74-b332086082d4.png)
 
 Muutin myös skriptin ajamisoikeuksia komennolla:
 
    > Set-ExecutionPolicy RemoteSigned
      A
   
 ![image](https://user-images.githubusercontent.com/106889187/235469290-15a4f4f4-250d-4ed7-9bd9-19176830aee8.png)

Tajusin mahdollisen tietoturvariskin ja muutin kaikkien ohjelmien ajamisoikeudet takaisin pois. Käytin sen sijaan komentoa:

    > Unblock-File -Path .\hellowindows.ps1
    
 Antaakseni vain tälle tiedostolle suoritusoikeuden.
 
 Seuraavaksi loin uuden kansiopolun komennolla:
 
     > mkdir /srv/salt/winstate
     
  ![image](https://user-images.githubusercontent.com/106889187/235471205-8fd94490-5583-43f6-831d-d7d75ec07f0c.png)

Kopion aikaisemmin luodon skriptin uuden kansion sisälle komennolla:

     > Copy-Item "C:\WINDOWS\system32\scripttest\hellowindows.ps1"  -Destination "C:\srv\salt\winstate\"
     
 Lisäsin kansion Winstate sisälle Init.sls-tiedoston komennolla:
 
    > notepad init.sls 
    
 Tiedoston sisälle laitoin:
 
    mkdir C:\WINDOWS\system32\scripttest:
      cmd.run:
       - creates: C:\WINDOWS\system32\scripttest 



    C:\WINDOWS\system32\scripttest\hellowindows.ps1:
      file.managed:
        - source: "salt://winstate/hellowindows.ps1"
        - shell : "powershell"




    
 Kokeilin suorittaa uuden tilan komennolla: 
 
    > salt-call --local state.apply winstate
    
 Mutta sain seuraavanlaisen viestin:
 
 ![image](https://user-images.githubusercontent.com/106889187/235475564-3c2c9865-569a-4960-a7aa-4e70d74eacc9.png)

Löysin mahdollisen vastauksen Hanna Gröndahlin raportista (https://github.com/hannagrn/palvelinten-hal/blob/main/h5.md) miten toteuttaa Saltin tiloja paikallisesti.

Kävin muokkaamassa polussa 'C:\ProgramData\Salt Project\Salt\conf' Minion-tiedoston arvoja seuraavanlaisesti:

Rivillä 633 muutin arvoksi '#file_client: remote -> file_client: local'.

![image](https://user-images.githubusercontent.com/106889187/235477903-4952cb28-503d-4de2-8269-2ce532ba66a9.png)

ja riveillä 650-652 poistin #-merkit rivien edestä.

![image](https://user-images.githubusercontent.com/106889187/235478572-2b5d6581-412c-4c63-8644-39c2e4d12410.png)

Kokeilin uudestaan näiden muutoksien jälkeen komentoa:

   > salt-call --local state.apply winstate


 ## Lopuksi (0:41)
 
 Tässä harjoituksessa asensin Vagrantin avulla virtuaalikoneita ja harjoittelin komentojen antamista usealla eri koneelle käyttäen Salt-ohjelmaa.
 
## Lähteet



Infra as Code course 2023 Kevät, Tero Karvinen (https://terokarvinen.com/2023/palvelinten-hallinta-2023-kevat/)

Create a Web Page Using Github, Tero Karvinen (28.3.2023)  (https://terokarvinen.com/2023/create-a-web-page-using-github/)

Salt Vagrant - automatically provision one master and two slaves, Tero Karvinen (28.3.2023) (https://terokarvinen.com/2023/salt-vagrant/)

Create Virtual Machines with Vagrant, Tuomas Valkamo (5.12.2022) (https://tuomasvalkamo.com/CMS-course/week-6/)



#### Tehnyt Roi Partanen 2.4.2023-3.4.2023

